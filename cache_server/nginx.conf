user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 1024;
    # multi_accept on;
}

http {
    server {
        listen 6060;

        # https://bazel.build/remote/caching#nginx
        location / {
            root /cache/toyotacache;

            # drake-ci does a GET on / and disables the cache if unsuccessful.
            # Since we are serving content from /cache/toyotacache, we cannot
            # also serve /var/www/html using the `index` directive.  One
            # solution is to create /cache/toyotacache/index.html, however in
            # the event of automated (or reckless manual) cleanup if the file
            # is deleted then even though the server is live, the GET / will
            # fail.  Instead, we use `autoindex` which will just provide a
            # directory listing of a given folder (along with a valid http
            # status code).  Since the cache server is hidden from the rest of
            # the internet, we do not need to worry about prying eyes.
            autoindex on;

            # Allow PUT
            dav_methods PUT;
            # Allow nginx to create the /ac and /cas subdirectories.
            create_full_put_path on;
            # The maximum size of a single file.
            client_max_body_size 1G;
            allow all;
        }
    }
}
